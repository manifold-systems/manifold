# Preprocessor symbols for Android applications

**`manifold-preprocessor-android-syms`**

<!-- TOC -->
* [Preprocessor symbols for Android applications](#preprocessor-symbols-for-android-applications)
* [Overview](#overview)
    * [Example: Boolean Constant](#example-boolean-constant)
* [Usage](#usage)
* [Regenerating `BuildConfig.java` After Variant Changes](#regenerating-buildconfigjava-after-variant-changes)
    * [✅ Steps to Refresh `BuildConfig.java`](#-steps-to-refresh-buildconfigjava)
* [Declaring Custom BuildConfig Fields](#declaring-custom-buildconfig-fields)
<!-- TOC -->

# Overview

`manifold-preprocessor-android-syms` automatically maps Android build variant information to preprocessor symbols. 
This includes constants defined in `BuildConfig.java`, which is generated by the Android Gradle plugin.

These constants can be used directly in preprocessor conditionals. For example:

- Boolean constants (like `DEBUG`) are treated as either **defined** (`true`) or **undefined** (`false`).
- Other constants are mapped with their literal values.

### Example: Boolean Constant
```csharp
#if DEBUG
  public void foo() {
    ...
  }
#endif
```

You can use other symbols from BuildConfig too, such `FLAVOR`:

```csharp
#if FLAVOR == "admin"
  public void reset() {
  . . .
  }
#endif
```

# Usage

This module is designed to work in tandem with the [manifold-preprocessor](https://github.com/manifold-systems/manifold/tree/master/manifold-preprocessor).

Both libraries should be declared as either `compileOnly`(Kotlin DSL) or `annotationProcessor`(Groovy DSL) dependencies:

```kotlin
dependencies {
    compileOnly("systems.manifold:manifold-preprocessor:2025.1.27")
    compileOnly("systems.manifold:manifold-preprocessor-android-syms:2025.1.27")
}
```

See [manifold-preprocessor](https://github.com/manifold-systems/manifold/tree/master/manifold-preprocessor) for complete
build setup instructions.

# Regenerating `BuildConfig.java` After Variant Changes

When you change the build variant (e.g., from *fullDebug* to *fullRelease*), the `BuildConfig.java` file **should** be regenerated automatically by the Gradle build system. However, this doesn’t always happen immediately or reliably. To ensure your preprocessor symbols reflect the current build variant, you may need to force regeneration.

### ✅ Steps to Refresh `BuildConfig.java`

1. **Sync Gradle**
   Use **File → Sync Project with Gradle Files** to trigger regeneration of build artifacts.


2. **Clean or Rebuild the Project**
   Use **Build → Clean Project** followed by **Build → Rebuild Project** to fully regenerate all generated sources.


3. **Verify the Output**
   You can inspect the generated `BuildConfig.java` file at:

   ```
   <project-root>/app/build/generated/source/buildConfig/<variant>/...
   ```

# Declaring Custom BuildConfig Fields

If you're relying on custom values in `BuildConfig`, define them in your `build.gradle` using the appropriate syntax.

**Kotlin DSL**

```kotlin
flavorDimensions += "subscription"

productFlavors {
    create("bronze") {
        dimension = "subscription"
        buildConfigField("String", "SUBSCRIPTION", "\"bronze\"")
    }
    create("silver") {
        dimension = "subscription"
        buildConfigField("String", "SUBSCRIPTION", "\"silver\"")
    }
    create("gold") {
        dimension = "subscription"
        buildConfigField("String", "SUBSCRIPTION", "\"gold\"")
    }
}
```

**Groovy DSL**

```groovy
flavorDimensions "subscription"

productFlavors {
   bronze {
      dimension "subscription"
      buildConfigField "String", "SUBSCRIPTION", "\"bronze\""
   }
   silver {
      dimension "subscription"
      buildConfigField "String", "SUBSCRIPTION", "\"silver\""
   }
   gold {
      dimension "subscription"
      buildConfigField "String", "SUBSCRIPTION", "\"gold\""
   }
}
```


